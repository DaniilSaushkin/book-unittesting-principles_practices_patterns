Хороший юнит-тест должен обладать следующими атрибутами:
- Защита от багов
- Устойчивость к рефакторингу
- Быстрая обратная связь
- Простота поддержки

Чтобы оценить, насколько хорошо тест проявляет себя, нужно обратить внимание на следующие аспекты:
- Объем кода, выполняемого тестом
- Сложность этого кода
- Важность кода с точки зрения бизнес-логики

Код, содержащий сложную бизнес-логику, важнее инфраструктурного кода, так как ошибки в критичной для бизнеса функциональности наносят наибольший ущерб.

Ложные срабатывания тестов нужно рефакторить, а не забивать на них и отключать.

Важно проверять результат работы кода, а не особенности его имплементации.

**Рефакторинг** – это изменение деталей имплементации без изменения наблюдаемого поведения.

Разница между хорошим тестом и плохим тестом, в том, что хороший тест проверяет результат, а плохой тест проверяет процесс работы системы


| |  |**Функциональность**| **Функциональность**  |
|---|---|---|---|
| | |**Работает правильно**|**Работает неправильно**|
|**Тест**|**…проходит**|Истинное отрицательное срабатывание|Ошибка 2 рода (Ложноотрицательное срабатывание) (Защита от багов)|
| **Тест** |**…не проходит**|Ошибка 1 рода (Ложное срабатывание) (Устойчивость к рефакторингу)|Истинное срабатывание|

Ложные и ложноотрицательные срабатывания можно также рассматривать в контексте отношения «сигнал/шум». Чтобы узнать точность теста, нужно разделить сигнал(количество обнаруженных ошибок) на шум(количество ложных срабатываний).

Если у теста много ложных срабатываний, то если этот тест покажет на реальную ошибку, то она может потеряться в море ложных срабатываний.

Влияние на проект ложных срабатываний и ложноотрицательных срабатываний со временем

Доверие к тестам быстро теряется, если они перестают рассматриваться как надежный источник обратной связи.

Чтобы тест был эффективным, нужно чтобы он был хорош во всех четырех категориях.

Лучше немного, но очень хороших тестов, чем много посредственных тестов.

Сквозные тесты (end-to-end) устойчивы к рефакторингу, и они защищают от багов, но они очень медленны, так как проверяют систему целиком.

С другой стороны, есть тривиальные тесты, где скорость и рефакторинг на высоком уровне, но вот шанс что там будет ошибка – очень мала, что означает малую эффективность теста.

Также есть хрупкие тесты, которые работают быстро и выявляют ошибка, но при этом у них ОЧЕНЬ большое количество ложных срабатываний.

Но идеальный тест создать невозможно.

Так как достичь идеального результата не получиться, то нужно выбирать компромисс и идти на уступки, при этом идти на уступки у атрибута «Устойчивость к рефакторингу» нельзя, то есть нужно выбирать из двух других атрибутов.

Что касается простоты поддержки, то он не связан с тремя атрибутами, которые разбирали выше.

Устойчивость к рефакторингу не должна быть предметом компромиссов, потому что тут выбор сводится к бинарному – устойчивость либо есть, либо её нет.

Соотношение тестов должно быть примерно таким: Юнит-тесты должны занимать 50% всех тестов, в то время как интеграционные должны занимать 30% и оставшиеся 20% должны занимать сквозные тесты. 

У пирамиды тестирования есть исключения. Например, если ваше приложение составляет по минимуму бизнес-логики и в основном это CRUD-операции, то количество интеграционных тестов и юнит-тестов у вас будет примерно одинаковое. А в самых тривиальных случаях, интеграционных тестов может быть больше, чем юнит-тестов.

Устойчивость к рефакторингу должна быть у всех видов тестов, в то время как быстрая обратная связь должна больше относится к юнит-тестам, а защита от багов к сквозным тестам и остается примерно на середине этих компромиссов, между защитой от багов и быстрой обратной связью, интеграционные тесты.

Также есть принцип тестирования черный/белый ящик. Черный ящик проверяет только конечный результат, а белый проверяет внутренности кода, что делает белый ящик очень хрупким.

Достоинства и недостатки этого принципа:

| |**Защита от багов**|**Устойчивость к рефакторингу**|
|---|---|---|
|_Тестирование по принципу «белого ящика»_|Хорошая|Плохая|
|_Тестирование по принципу «черного ящика»_|Плохая|Хорошая|

Нужно отдавать предпочтение тестированию по принципу «Черного ящика», так как устойчивость к рефакторингу важна и её надо максимизировать.

Необходимо использовать принцип «черного ящика» при написании тестов, а принцип «белого ящика» при анализе тестов, такое сочетание будет наилучшим.