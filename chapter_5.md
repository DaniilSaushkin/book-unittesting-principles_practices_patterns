Вместо того, чтобы проверять детали имплементации, проверять необходимо конечный результат, именно так можно добиться устойчивости к рефакторингу для теста.

Весь рабочий код можно классифицировать по двум измерениям:
- Публичный или приватный API
- Наблюдаемое поведение или детали имплементации

Метод не может быть одновременно и публичным и приватным API, также не может быть наблюдаемым поведением и деталей имплементации одновременно.

Чтобы код мог считаться частью наблюдаемого поведения, он должен выполнять одно из следующих задач:
- Предоставлять операцию, которая помогает клиенту достичь его цели
- Предоставлять доступ к состоянию системы.

**Инкапсуляция** - защита вашего кода от нарушений логической целостности, также называемых **нарушениями инвариантов**.

==**Хорошо спроектированный API автоматически улучшает юнит-тесты**==

|               | Наблюдаемое поведение | Детали имплементации |
| ------------- | :---------------------: | :--------------------: |
| Публичный код | Хорошо                | Плохо                |
| Приватный код | -                     | Хорошо               |
 
Тесты не должны проверять приватные методы напрямую, они должны проверять его как часть наблюдаемого поведения.

Виды взаимодействий:
- **Внутрисистемные взаимодействия** - взаимодействие классов и методов внутри вашего приложения
- **Межсистемные взаимодействия** - взаимодействие между вашим приложением и внешним приложением

==**Внутрисистемные взаимодействия являются деталями имплементации. Межсистемные взаимодействия являются наблюдаемым поведением**==

Обращения к внешним системам, например, SMTP-сервис это уважительное применение моков.

Но не все внепроцессные зависимости должны заменяться моками, например, если внешнее приложение доступно только через ваше приложение, то оно должно проверяться тестом. Хороший пример - база данных, которая используется только вашим приложением.

Возможность выполнения тестов в случайном порядке и неограниченное количество раз называется **изоляцией тестов**.

Клиенту неинтересно какие нейроны в вашем мозгу активизируются, когда он обращается к вам за помощью. Важна лишь сама помощь, её качество и профессионализм.